<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tur Virtual Rumah Adat Balla Lompoa Karaeng Galesong</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <link rel="stylesheet" href="css/vtour.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

</head>
<body>
<div class="top-bar">
  <a href="index.html" class="go-home">← Kembali ke Beranda</a>
  <h3 class="page-title">Tur Virtual Rumah Adat Balla Lompoa Karaeng Galesong</h3>
  <div class="top-bar__actions">
    <button class="minimap-btn" onclick="showMinimap()">Tampilkan Minimap</button>
    <button id="toggleDragBtn" class="minimap-btn">Nonaktifkan Drag</button>
  </div>
</div>

<!-- Modal Minimap -->
<div id="minimapModal" class="minimap-modal" onclick="hideMinimap()">
  <img src="images/minimap.jpg" alt="Minimap Virtual Tour" class="minimap-img">
</div>

<div id="panorama"></div>
<div class="scenes">
  <!-- Static scene buttons without any loop -->
  <button onclick="viewer.loadScene('s0')">0</button>
  <button onclick="viewer.loadScene('s1')">1</button>
  <button onclick="viewer.loadScene('s2')">2</button>
  <button onclick="viewer.loadScene('s3')">3</button>
  <button onclick="viewer.loadScene('s4')">4</button>
  <button onclick="viewer.loadScene('s5')">5</button>
  <button onclick="viewer.loadScene('s6')">6</button>
  <button onclick="viewer.loadScene('s7')">7</button>
  <button onclick="viewer.loadScene('s8')">8</button>
  <button onclick="viewer.loadScene('s9')">9</button>
  <button onclick="viewer.loadScene('s10')">10</button>
  <button onclick="viewer.loadScene('s11')">11</button>
  <button onclick="viewer.loadScene('s12')">12</button>
  <button onclick="viewer.loadScene('s13')">13</button>
  <button onclick="viewer.loadScene('s14')">14</button>
  <button onclick="viewer.loadScene('s15')">15</button>
</div>

<script>

  // function renderAlertHotspot(hotSpotDiv, args) {
  //   hotSpotDiv.classList.add('custom-hotspot');

  //   if (args) {
  //     const tooltip = document.createElement('span');
  //     tooltip.textContent = args;
  //     hotSpotDiv.appendChild(tooltip);
  //   }
  // }

  /*
    // === Generator otomatis hotspot ===
    // const LAST_SCENE_INDEX = 53;
    // const scenes = {};
    // for (let i = 0; i <= LAST_SCENE_INDEX; i += 1) {
    //   const sceneId = `s${i}`;
    //   const entry = {
    //     title: `Spot ${i}`,
    //     type: "equirectangular",
    //     panorama: `panos/image${i}.jpg`
    //   };
    //   if (i < LAST_SCENE_INDEX) {
    //     entry.hotSpots = [{
    //       pitch: 0,
    //       yaw: 0,
    //       type: "scene",
    //       sceneId: `s${i + 1}`,
    //       text: `Ke Spot ${i + 1}`
    //     }];
    //   }
    //   scenes[sceneId] = entry;
    // }
    // var viewer = pannellum.viewer('panorama', {
    //   "default": {
    //     "firstScene": "s0",
    //     "autoLoad": true,
    //     "showControls": true
    //   },
    //   "scenes": scenes
    // });
  */

  // === Konfigurasi manual dengan hotspot eksplisit ===
  var viewer = pannellum.viewer('panorama', {
    "default": {
      "firstScene": "s0",
      "autoLoad": true,
      "showControls": true
    },
    "scenes": {
      "s0":  { 
        "title": "Halaman Depan",  
        "type": "equirectangular", 
        "panorama": "panos/image0.jpg",  
        "hotSpots": [
            {   "pitch": 0, 
                "yaw": 16.52, 
                "type": "scene", 
                "sceneId": "s1",  
                "text": "Ke Spot 8"    
            },
            {   "pitch": -2, 
                "yaw": 35.62, 
                "type": "scene", 
                "sceneId": "s2",  
                "text": "Ke Spot 2"    
            },
            {   "pitch": -1.37, 
                "yaw": -27.83, 
                "type": "scene", 
                "sceneId": "s3",  
                "text": "Ke Spot 5"    
            },
        {
            "pitch": -5.23,
            "yaw": 41.03,
            "type": "info",
            "text": "sisi kanan Rumah Adat Balla Lompoa Karaeng Galesong",
        },
        
        {
            "pitch": -3.05,
            "yaw": -30.86,
            "type": "info",
            "text": "sisi kiri Rumah Adat Balla Lompoa Karaeng Galesong",
        },

        {
            "pitch": 17.58,
            "yaw": -5.49,
            "type": "info",
            "text": "ulu tedong. yang bermakna binatang paling besar tapi tunduk pada rajanya dan mudah diperintah dan tanduk itulah jika raja yang datang dan berdiri ditengah antara kedua tanduk  maka menggambarkan tiga huruf yaituh Allah. Dan di bawahnya itu rukun rukunya. Jadi karaeng Galesong merupakan orang yang sanagat kuat akan agama islam dan adatnya.",
        },
        
        {
            "pitch": 13.56,
            "yaw": 18.38,
            "type": "info",
            "text": "Salewang.  juga dapat dimaknai dengan takbir karna bentuknya yang menyilang dan salewanga merupakan bentuk perwujudan akan penghuni rumah tersebut yaituh Leburan yang artinya umur panjang maksudya dengan harapan penghuni rumah tersebut memiliki umur yang panjang sehat dan sebagainya.",
        },

        {
            "pitch": 7.76,
            "yaw": 1.19,
            "type": "info",
            "text": "Sambulayang.Simbol tingkatan status sosial penghuni rumah.",
        },

        {
            "pitch": 1.93,
            "yaw": -6.08,
            "type": "info",
            "text": "Jendela. Tiga jendela bagian depan memiliki unsur bahwa manusia itu ada tiga susun secara vertical, yaitu bagian atas kepala sampai dagu, bagian Tengah dagu hingga pusat, dan bagian bawah yaitu pusat hingga ujung kaki",
        },

      ] },
      "s1":  { 
        "title": "Pintu Masuk",  
        "type": "equirectangular", 
        "panorama": "panos/image1.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s2",  
            "text": "Ke Spot 2" }] },
      
      "s2":  { 
        "title": "Rumah Samping kanan",  
        "type": "equirectangular", 
        "panorama": "panos/image2.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s3",  
            "text": "Ke Spot 3" },
             {
            "pitch": 6.09,
            "yaw": -38.79,
            "type": "info",
            "text": "Ornamen A'labu nai memiliki makna khusus bagi masyarakat Galesong pada masa lalu. Motif-motif tersebut merupakan ekspresi kepercayaan masyarakat tentang hubungan kepada Tuhan dan hubungan dengan sesama manusia.",
             },
         ] },
            
      "s3":  { 
        "title": "Rumah Samping Kanan",  
        "type": "equirectangular", 
        "panorama": "panos/image3.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s4",  
            "text": "Ke Spot 4" },
             {
            "pitch": -2.13,
            "yaw": -15.22,
            "type": "info",
            "text": "Tiang (benteng)Terdiri dari 36 tiang kayu utama Angka 36 dipilih karena memiliki makna keseimbangan dan kekuatan.",
             },
        ] },

      "s4":  { 
        "title": "Rumah Samping Kiri",  
        "type": "equirectangular", 
        "panorama": "panos/image4.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s5",  
            "text": "Ke Spot 5" },

        ] },
      "s5":  { 
        "title": "Rumah Samping Kiri",  
        "type": "equirectangular", 
        "panorama": "panos/image5.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s6",  
            "text": "Ke Spot 6" },
              {
            "pitch": 19.66,
            "yaw": -21.95,
            "type": "info",
            "text": "Jendela Samping. ",
             },
        ] },
      "s6":  { 
        "title": "Rumah Samping Kiri",  
        "type": "equirectangular", 
        "panorama": "panos/image6.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s7",  
            "text": "Ke Spot 7" }
        ] },
      "s7":  { 
        "title": "Tangga ",  
        "type": "equirectangular", 
        "panorama": "panos/image7.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s8",  
            "text": "Ke Spot 8" }
        ] },
      "s8":  { 
        "title": "Jalan menuju Teras Rumah",  
        "type": "equirectangular", 
        "panorama": "panos/image8.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s9",  
            "text": "Ke Spot 9" }
        ] },
      "s9":  { 
        "title": "Teras Rumah",  
        "type": "equirectangular", 
        "panorama": "panos/image9.jpg",  
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s10", 
            "text": "Ke Spot 10" }
        ] },
      "s10": { 
        "title": "Pintu Masuk Kale balla", 
        "type": "equirectangular", 
        "panorama": "panos/image10.jpg", 
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s11", 
            "text": "Ke Spot 11" }
        ] },
      "s11": { 
        "title": "Bagian luar dari kale balla", 
        "type": "equirectangular", 
        "panorama": "panos/image11.jpg", 
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s12", 
            "text": "Ke Spot 12" }
        ] },
      "s12": { 
        "title": "Kale balla atau ruang utama", 
        "type": "equirectangular", 
        "panorama": "panos/image12.jpg", 
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s13", 
            "text": "Ke Spot 13" }
        ] },
      "s13": { 
        "title": "Spot 13", 
        "type": "equirectangular", 
        "panorama": "panos/image13.jpg", 
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s14", 
            "text": "Ke Spot 14" }
        ] },
      "s14": { 
        "title": "Spot 14", 
        "type": "equirectangular", 
        "panorama": "panos/image14.jpg", 
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s15", 
            "text": "Ke Spot 15" }
        ] },
      "s15": { 
        "title": "Spot 15", 
        "type": "equirectangular", 
        "panorama": "panos/image15.jpg", 
        "hotSpots": [
            { "pitch": 0, 
            "yaw": 0, 
            "type": "scene", 
            "sceneId": "s16", 
            "text": "Ke Spot 16" }
        ] },
    }
  });

  // Fungsi untuk menampilkan modal minimap
  function showMinimap() {
    document.getElementById('minimapModal').classList.add('active');
  }
  function hideMinimap() {
    document.getElementById('minimapModal').classList.remove('active');
  }

  // === Menampilkan koordinat pitch dan yaw saat panorama di-klik ===
  const panoramaEl = document.getElementById('panorama');
  const coordDiv = document.createElement('div');
  coordDiv.className = 'coord-hint';
  coordDiv.textContent = 'Klik panorama untuk koordinat';
  if (panoramaEl) {
    panoramaEl.appendChild(coordDiv);
  } else {
    document.body.appendChild(coordDiv);
  }
  const toggleBtn = document.getElementById('toggleDragBtn');
  const viewerContainer = typeof viewer.getContainer === 'function'
    ? viewer.getContainer()
    : panoramicFallback();

  let dragEnabled = true;

  function panoramicFallback() {
    return panoramaEl.querySelector('.pnlm-container') || panoramaEl;
  }

  function setCoordHint(message) {
    coordDiv.textContent = message;
  }

  function showCoords(event) {
    const coords = viewer.mouseEventToCoords(event);
    if (coords && Number.isFinite(coords.yaw) && Number.isFinite(coords.pitch)) {
      coordDiv.textContent = `Yaw: ${coords.yaw.toFixed(2)}, Pitch: ${coords.pitch.toFixed(2)}`;
    } else {
      const fallbackYaw = typeof viewer.getYaw === 'function' ? viewer.getYaw() : NaN;
      const fallbackPitch = typeof viewer.getPitch === 'function' ? viewer.getPitch() : NaN;
      if (Number.isFinite(fallbackYaw) && Number.isFinite(fallbackPitch)) {
        coordDiv.textContent = `Yaw: ${fallbackYaw.toFixed(2)}, Pitch: ${fallbackPitch.toFixed(2)}`;
      } else {
        setCoordHint('Tidak dapat membaca koordinat');
      }
    }
  }

  function handlePointer(event) {
    if (!dragEnabled) {
      showCoords(event);
      event.stopPropagation();
      event.preventDefault();
    }
  }

  function handleScroll(event) {
    if (!dragEnabled) {
      event.stopPropagation();
      event.preventDefault();
    }
  }

  const wheelListenerOptions = { capture: true, passive: false };

  function disableDrag() {
    dragEnabled = false;
    panoramaEl.style.cursor = 'pointer';
    viewerContainer.style.cursor = 'pointer';
    viewerContainer.addEventListener('mousedown', handlePointer, true);
    viewerContainer.addEventListener('touchstart', handlePointer, true);
    viewerContainer.addEventListener('click', handlePointer, true);
    viewerContainer.addEventListener('touchend', handlePointer, true);
    viewerContainer.addEventListener('wheel', handleScroll, wheelListenerOptions);
    toggleBtn.textContent = 'Aktifkan Drag';
    setCoordHint('Mode koordinat aktif — klik panorama');
  }

  function enableDrag() {
    dragEnabled = true;
    panoramaEl.style.cursor = 'grab';
    viewerContainer.style.cursor = 'grab';
    viewerContainer.removeEventListener('mousedown', handlePointer, true);
    viewerContainer.removeEventListener('touchstart', handlePointer, true);
    viewerContainer.removeEventListener('click', handlePointer, true);
    viewerContainer.removeEventListener('touchend', handlePointer, true);
    viewerContainer.removeEventListener('wheel', handleScroll, wheelListenerOptions);
    toggleBtn.textContent = 'Nonaktifkan Drag';
    setCoordHint('Klik panorama untuk koordinat');
  }

  toggleBtn.onclick = function() {
    if (dragEnabled) {
      disableDrag();
    } else {
      enableDrag();
    }
  };

  // Set cursor awal dan pesan bawaan
  enableDrag();

  document.addEventListener('click', () => {
    document.querySelectorAll('.hotspot-alert.is-open').forEach((node) => node.classList.remove('is-open'));
  });
</script>

</body>
</html>