<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tur Virtual Rumah Adat Balla Lompoa Karaeng Galesong</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <link rel="stylesheet" href="css/article.css"> 
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

    <style>
        .coord-hint {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 1000;
            font-family: sans-serif;
            font-size: 12px;
        }
        .minimap-modal {
            display: none; /* Awalnya tersembunyi */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            cursor: pointer; /* Menunjukkan bisa diklik untuk menutup */
        }
        .minimap-modal.active {
            display: flex; /* Tampilkan saat aktif */
        }
        .minimap-png {
            max-width: 90%;
            max-height: 90%;
            border: 3px solid white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            /* Penting: mencegah klik pada gambar minimap menonaktifkan modal */
            pointer-events: none; 
        }
        /* Tambahkan beberapa style untuk tombol scenes agar terlihat */
        .scenes {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
            border-radius: 10px;
        }
        .scenes button {
            background: #fff;
            border: 1px solid #ccc;
            padding: 5px 10px;
            margin: 0 2px;
            cursor: pointer;
            border-radius: 5px;
        }
        #panorama {
            width: 100%;
            height: 100vh; /* Pastikan panorama mengisi seluruh viewport */
        }
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(18, 5, 90, 0.7);
            color: rgb(235, 238, 226);
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1500;
            font-family: sans-serif;
        }
        .top-bar a {
            color: white;
            text-decoration: none;
            padding: 5px;
        }
        .top-bar h3 {
            margin: 0;
            font-size: 1em;
        }
        .minimap-btn {
            background: #5bc0de;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            margin-left: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div class="top-bar">
    <a href="index.html" class="go-home">← Kembali ke Beranda</a>
    <h3 class="page-title">Tur Virtual Rumah Adat Balla Lompoa Karaeng Galesong</h3>
    <div class="top-bar__actions">
        <button class="minimap-btn" onclick="showMinimap()">Tampilkan Minimap</button>
        <button id="toggleDragBtn" class="minimap-btn">Nonaktifkan Drag</button>
    </div>
</div>

<div id="minimapModal" class="minimap-modal" onclick="hideMinimap()">
    <img src="images\minimap.png" alt="Minimap Virtual Tour" class="minimap-png">
</div>

<div id="panorama"></div>
<div class="scenes">
    <button onclick="viewer.loadScene('s0')">0</button>
    <button onclick="viewer.loadScene('s1')">1</button>
    <button onclick="viewer.loadScene('s2')">2</button>
    <button onclick="viewer.loadScene('s3')">3</button>
    <button onclick="viewer.loadScene('s4')">4</button>
    <button onclick="viewer.loadScene('s5')">5</button>
    <button onclick="viewer.loadScene('s6')">6</button>
    <button onclick="viewer.loadScene('s7')">7</button>
    <button onclick="viewer.loadScene('s8')">8</button>
    <button onclick="viewer.loadScene('s9')">9</button>
    <button onclick="viewer.loadScene('s10')">10</button>
    </div>

<script>
    // Fungsi untuk menampilkan modal minimap
    function showMinimap() {
        // Mengubah display: none menjadi display: flex (berdasarkan CSS yang ditambahkan)
        document.getElementById('minimapModal').classList.add('active'); 
    }
    // Fungsi untuk menyembunyikan modal minimap
    function hideMinimap(event) {
        // Hanya menyembunyikan jika diklik di luar gambar minimap
        if (event.target.id === 'minimapModal') {
            document.getElementById('minimapModal').classList.remove('active');
        }
    }
    
    // === Konfigurasi manual dengan hotspot eksplisit ===
    var viewer = pannellum.viewer('panorama', {
        "default": {
            "firstScene": "s0",
            "autoLoad": true,
            "showControls": true
        },
        "scenes": {
            "s0": 	{ 
                "title": "Halaman Depan", 	
                "type": "equirectangular", 
                "panorama": "panos/image0.jpg", 	
                "hotSpots": [
                    // Hotspot Pindah Adegan. Diarahkan ke adegan berikutnya: s3
                    { 	"pitch": 0, 
                        "yaw": 16.52, 
                        "type": "scene", 
                        "sceneId": "s1", 	// **PERBAIKAN: Berpindah ke s3** "text": "Tangga Rumah Adat Balla Lompoa Karaeng Galesong (Spot 3)" 	
                    },
                    // Hotspot Info
                    {
                        "pitch": -5.23,
                        "yaw": 41.03,
                        "type": "info",
                        "text": "sisi kanan Rumah Adat Balla Lompoa Karaeng Galesong",
                    },
                    {
                        "pitch": -3.05,
                        "yaw": -30.86,
                        "type": "info",
                        "text": "sisi kiri Rumah Adat Balla Lompoa Karaeng Galesong",
                    },
                    {
                        "pitch": 17.58,
                        "yaw": -5.49,
                        "type": "info",
                        "text": "ulu tedong. yang bermakna binatang paling besar tapi tunduk pada rajanya dan mudah diperintah dan tanduk itulah jika raja yang datang dan berdiri ditengah antara kedua tanduk  maka menggambarkan tiga huruf yaituh Allah. Dan di bawahnya itu rukun rukunya. Jadi karaeng Galesong merupakan orang yang sanagat kuat akan agama islam dan adatnya.",
                    },
                    {
                        "pitch": 13.56,
                        "yaw": 18.38,
                        "type": "info",
                        "text": "Salewang.  juga dapat dimaknai dengan takbir karna bentuknya yang menyilang dan salewanga merupakan bentuk perwujudan akan penghuni rumah tersebut yaituh Leburan yang artinya umur panjang maksudya dengan harapan penghuni rumah tersebut memiliki umur yang panjang sehat dan sebagainya.",
                    },
                    {
                        "pitch": 7.76,
                        "yaw": 1.19,
                        "type": "info",
                        "text": "Sambulayang.Simbol tingkatan status sosial penghuni rumah.",
                    },
                    {
                        "pitch": 1.93,
                        "yaw": -6.08,
                        "type": "info",
                        "text": "Jendela. Tiga jendela bagian depan memiliki unsur bahwa manusia itu ada tiga susun secara vertical, yaitu bagian atas kepala sampai dagu, bagian Tengah dagu hingga pusat, dan bagian bawah yaitu pusat hingga ujung kaki",
                    },
                ] 
            },
            "s1": 	{ 
                "title": "Rumah Samping Kiri", 	
                "type": "equirectangular", 
                "panorama": "panos/image1.jpg", 	
                "hotSpots": [
                    // Hotspot Pindah Adegan. Diarahkan ke adegan berikutnya: s2
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s2", 	// **PERBAIKAN: Berpindah ke s2**
                    "text": "Ke Rumah Samping Kanan (Spot 2)" },
                    {
                        "pitch": 7.31,
                        "yaw": -31.18,
                        "type": "info",
                        "text": "Ornamen A'labu nai memiliki makna khusus bagi masyarakat Galesong pada masa lalu. Motif-motif tersebut merupakan ekspresi kepercayaan masyarakat tentang hubungan kepada Tuhan dan hubungan dengan sesama manusia.",
                    },
                ] 
            },
            "s2": 	{ 
                "title": "Rumah Samping Kanan", 	
                "type": "equirectangular", 
                "panorama": "panos/image2.jpg", 	
                "hotSpots": [
                    // Hotspot Pindah Adegan. Diarahkan ke adegan berikutnya: s3
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s3", 	// **PERBAIKAN: Berpindah ke s3**
                    "text": "Ke Tangga (Spot 3)" },
                    {
                        "pitch": -4.92,
                        "yaw": -24.09,
                        "type": "info",
                        "text": "Tiang. Tiang ini Terdiri dari 36 tiang kayu utama (6 baris ke samping × 6 ke belakang) disusun simetris dalam pola kisi (grid).Angka 36 dipilih karena memiliki makna keseimbangan dan kekuatan ",
                    },
                    {
                        "pitch": 13.00,
                        "yaw": -31.37,
                        "type": "info",
                        "text": "Jendela, Jumlah jendela yang ada pada dinding yaitu bagian samping empat jendela yang artinya bahwa alam semesta ini ada empat unsur, yakni air, api, angin, dan tanah.",
                    },
                ] 
            },
            "s3": 	{ 
                "title": "Tangga Rumah Adat Balla Lompoa Karaeng Galesong", 	
                "type": "equirectangular", 
                "panorama": "panos/image3.jpg", 	
                "hotSpots": [
                    // Hotspot Pindah Adegan. Diarahkan ke adegan berikutnya: s4
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s4", 	// **PERBAIKAN: Berpindah ke s4**
                    "text": "Ke Pintu Masuk (Spot 4)" },
                    {
                        "pitch": 8.87,
                        "yaw": 23.52,
                        "type": "info",
                        "text": "Lasugi,• Aspek counting pada Anyaman lasugi berimpit tiga yang terdiri dari kulit bambu dan tulang bambu memiliki arti tersendiri yakni kulit bambu sebagai simbol masyarakat dan tulang bambu sebagai simbol raja. Artinya adalah seorang raja yang mampu merangkul masyarakatnya (bersatu kuat).",
                    },
                    {
                        "pitch": 8.87,
                        "yaw": 23.52,
                        "type": "info",
                        "text": "Tangga, Memiliki jumlah anak tangga ganjil yaitu 11. Angka ganjil dimaknai sebagai simbol keberuntungan dan keseimbangan hidup.",
                    },
                ] 
            },

            "s4": 	{ 
                "title": "Pintu Masuk", 	
                "type": "equirectangular", 
                "panorama": "panos/image4.jpg", 	
                "hotSpots": [
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s5", 	
                    "text": "Ke Teras (Spot 5)" },
                ] 
            },
            "s5": 	{ 
                "title": "Teras", 	
                "type": "equirectangular", 
                "panorama": "panos/image5.jpg", 	
                "hotSpots": [
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s6", 	
                    "text": "Ke Pintu Masuk Ruang Utama (Spot 6)" },
                ] 
            },
            "s6": 	{ 
                "title": "Pintu Masuk Ruang Utama (Kale Balla')", 	
                "type": "equirectangular", 
                "panorama": "panos/image6.jpg", 	
                "hotSpots": [
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s7", 	
                    "text": "Ke Bagian Depan Kale Balla' (Spot 7)" }
                ] 
            },
            "s7": 	{ 
                "title": "Bagian Depan Dari Kale Balla'", 	
                "type": "equirectangular", 
                "panorama": "panos/image7.jpg", 	
                "hotSpots": [
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s8", 	
                    "text": "Ke Area Penghargaan (Spot 8)" }
                ] 
            },
            "s8": 	{ 
                "title": "Penghargaan dan miniatur Rumah Adat Balla Lompoa Karaeng Galesong", 	
                "type": "equirectangular", 
                "panorama": "panos/image8.jpg", 	
                "hotSpots": [
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s9", 	
                    "text": "Ke Kale Balla' (Spot 9)" }
                ] 
            },
            "s9": 	{ 
                "title": "Kale Balla'", 	
                "type": "equirectangular", 
                "panorama": "panos/image9.jpg", 	
                "hotSpots": [
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s10", // **PERBAIKAN: Berpindah ke s10** "text": "Ke Kale Balla' (Spot 10)" 
                    }
                ] 
            },
            "s10": { 
                "title": "Kale Balla' (Akhir)", 
                "type": "equirectangular", 
                "panorama": "panos/image10.jpg", 
                "hotSpots": [
                    // Hotspot terakhir, bisa diarahkan kembali ke adegan awal (s0)
                    { "pitch": 0, 
                    "yaw": 0, 
                    "type": "scene", 
                    "sceneId": "s0", // Kembali ke awal
                    "text": "Kembali ke Halaman Depan (Spot 0)" } 
                ] 
            },
            // Adegan s11 tidak didefinisikan, sehingga dihapus
        }
    });

    // === Logika untuk Menampilkan Koordinat Pitch dan Yaw ===
    const panoramaEl = document.getElementById('panorama');
    const coordDiv = document.createElement('div');
    coordDiv.className = 'coord-hint';
    coordDiv.textContent = 'Klik panorama untuk koordinat';
    if (panoramaEl) {
        panoramaEl.appendChild(coordDiv);
    } else {
        document.body.appendChild(coordDiv);
    }
    const toggleBtn = document.getElementById('toggleDragBtn');

    // Menggunakan fallback jika getContainer belum tersedia saat skrip dieksekusi
    function getViewerContainer() {
        return typeof viewer.getContainer === 'function' 
            ? viewer.getContainer()
            : (panoramaEl ? panoramaEl.querySelector('.pnlm-container') || panoramaEl : document.body);
    }
    let viewerContainer = getViewerContainer();

    let dragEnabled = true;

    function setCoordHint(message) {
        coordDiv.textContent = message;
    }

    function showCoords(event) {
        const coords = viewer.mouseEventToCoords(event);
        if (coords && Number.isFinite(coords.yaw) && Number.isFinite(coords.pitch)) {
            coordDiv.textContent = `Yaw: ${coords.yaw.toFixed(2)}, Pitch: ${coords.pitch.toFixed(2)}`;
        } else {
            setCoordHint('Tidak dapat membaca koordinat');
        }
    }

    function handlePointer(event) {
        if (!dragEnabled) {
            showCoords(event);
            event.stopPropagation();
            event.preventDefault();
        }
    }

    function handleScroll(event) {
        if (!dragEnabled) {
            event.stopPropagation();
            event.preventDefault();
        }
    }

    const wheelListenerOptions = { capture: true, passive: false };

    function disableDrag() {
        dragEnabled = false;
        panoramaEl.style.cursor = 'pointer';
        viewerContainer.style.cursor = 'pointer';

        // Hanya tambahkan listener jika belum ada
        viewerContainer.removeEventListener('click', handlePointer, true); // Pastikan tidak ada duplikat

        // Menambahkan listener untuk mendapatkan koordinat saat di-klik
        viewerContainer.addEventListener('click', handlePointer, true); 

        // Menambahkan listener untuk mematikan fungsi drag default pannellum
        viewerContainer.addEventListener('mousedown', (e) => { if (!dragEnabled) { e.stopPropagation(); e.preventDefault(); } }, true);
        viewerContainer.addEventListener('touchstart', (e) => { if (!dragEnabled) { e.stopPropagation(); e.preventDefault(); } }, true);
        viewerContainer.addEventListener('wheel', handleScroll, wheelListenerOptions);

        toggleBtn.textContent = 'Aktifkan Drag';
        setCoordHint('Mode koordinat aktif — klik panorama');
    }

    function enableDrag() {
        dragEnabled = true;
        panoramaEl.style.cursor = 'grab';
        viewerContainer.style.cursor = 'grab';

        // Hapus semua listener mode koordinat
        viewerContainer.removeEventListener('click', handlePointer, true);
        viewerContainer.removeEventListener('mousedown', (e) => { if (!dragEnabled) { e.stopPropagation(); e.preventDefault(); } }, true);
        viewerContainer.removeEventListener('touchstart', (e) => { if (!dragEnabled) { e.stopPropagation(); e.preventDefault(); } }, true);
        viewerContainer.removeEventListener('wheel', handleScroll, wheelListenerOptions);
        
        toggleBtn.textContent = 'Nonaktifkan Drag';
        setCoordHint('Klik panorama untuk koordinat');
    }
    
    // Perbarui viewerContainer setelah viewer dibuat
    viewerContainer = getViewerContainer();

    toggleBtn.onclick = function() {
        if (dragEnabled) {
            disableDrag();
        } else {
            enableDrag();
        }
    };

    // Set cursor awal dan pesan bawaan
    enableDrag();

    // Listener untuk menutup tooltip info saat klik di tempat lain
    document.addEventListener('click', (event) => {
        // Logika ini mungkin tidak diperlukan jika hanya menggunakan hotspot default Pannellum, 
        // tapi jika menggunakan custom hotspot, ini mungkin berguna
        // document.querySelectorAll('.hotspot-alert.is-open').forEach((node) => node.classList.remove('is-open'));
    });
</script>

</body>
</html>